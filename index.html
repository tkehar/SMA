<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-rounded@1.0.3/dist/aframe-rounded-component.min.js"></script>
    <script>
        AFRAME.registerComponent('proximity-reveal', {
    schema: {
        threshold: {type: 'number', default: 2}, // The distance at which it appears
        fadeInDur: {type: 'number', default: 500} // How fast it fades in
    },
    init: function () {
        // Start hidden
        this.el.setAttribute('active', false);
        this.el.setAttribute('material', 'opacity', 0);
        this.camera = document.querySelector('#main-camera');
    },
    tick: function () {
        const targetPos = new THREE.Vector3();
        const cameraPos = new THREE.Vector3();
        
        // Get world positions
        this.el.object3D.getWorldPosition(targetPos);
        this.camera.object3D.getWorldPosition(cameraPos);

        // Get the direction the camera is looking
        const cameraDir = new THREE.Vector3(0, 0, -1).applyQuaternion(this.camera.object3D.quaternion);
        
        // Calculate the vector from camera to the icon
        const vecToTarget = targetPos.clone().sub(cameraPos).normalize();
        
        // Use Dot Product to find how closely the camera is pointing at the target
        // 1.0 is a perfect look-at, lower is further away
        const angleMatch = cameraDir.dot(vecToTarget);

        // If the angle is tight enough (approx 0.95 to 0.99), reveal it
        if (angleMatch > 0.98) { // Adjust 0.98 to make it easier/harder to find
            if (!this.active) {
                this.el.setAttribute('animation', `property: material.opacity; to: 1; dur: ${this.data.fadeInDur}; easing: easeOutQuad`);
                this.active = true;
            }
        } else {
            if (this.active) {
                this.el.setAttribute('animation', `property: material.opacity; to: 0; dur: ${this.data.fadeInDur}; easing: easeInQuad`);
                this.active = false;
            }
        }
    }
});
        AFRAME.registerComponent('hover-info', {
        schema: { 
        id: {type: 'string', default: ''},
        title: {type: 'string', default: ''} 
        },
        init: function () {
        const el = this.el;
        
        el.addEventListener('mouseenter', () => {
            const worldTooltip = document.querySelector('#world-tooltip');
            const tooltipText = document.querySelector('#tooltip-text');
            const tooltipBg = document.querySelector('#tooltip-bg');
            let displayTitle = "";

            if (this.data.id && typeof ARCHIVE_DATABASE !== 'undefined') {
                const itemData = ARCHIVE_DATABASE[this.data.id];
                if (itemData) displayTitle = itemData.title;
            } else if (this.data.title) {
                displayTitle = this.data.title;
            }

            if (displayTitle && worldTooltip && tooltipText && tooltipBg) {
                // 1. Set the text value
                tooltipText.setAttribute('value', displayTitle);
                
                // 2. DYNAMIC SIZING: Calculate width based on character count
                // A multiplier of 0.1 to 0.12 usually fits standard fonts well
                const estimatedWidth = Math.max(0.5, displayTitle.length * 0.1);
                
                // Update the background size
                tooltipBg.setAttribute('width', estimatedWidth);
                
                // 3. CENTERING: a-rounded expands from the bottom-left. 
                // We must offset its X position by half its width to keep it centered under the text.
                tooltipBg.setAttribute('position', {
                    x: -(estimatedWidth / 2), 
                    y: 0, 
                    z: 0
                });

                // 4. Position the whole tooltip above the target icon
                const pos = el.getAttribute('position');
                worldTooltip.setAttribute('position', {
                    x: pos.x, 
                    y: pos.y + 0.4, 
                    z: pos.z
                });
                
                // Force look-at refresh and show
                if (worldTooltip.components['look-at']) worldTooltip.components['look-at'].update();
                worldTooltip.setAttribute('visible', true);
            }
        });

        el.addEventListener('mouseleave', () => {
            const worldTooltip = document.querySelector('#world-tooltip');
            if (worldTooltip) worldTooltip.setAttribute('visible', false);
        });
             }
        });
    </script>

  <style>
    /* 1. Landing Page Overlay - Added scrolling and alignment fixes */
    #landing-overlay {
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%;
        background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('Assets/Images/Landing image.webp');
        background-size: cover;
        background-position: center;
        z-index: 999;
        
        /* Enable mobile scrolling */
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        /* Uses flex-start so content doesn't get cut off at the top on small screens */
        justify-content: flex-start; 
        
        color: white; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        padding: 60px 20px; /* Space for the header and footer button */
        box-sizing: border-box;
    }

    /* 2. Container - Swaps from side-by-side to stacked on mobile */
    .content-container {
        display: flex;
        flex-direction: row;
        gap: 20px;
        max-width: 900px;
        width: 100%;
        margin: 30px 0;
    }

    /* 3. Individual Boxes - Reduced padding on mobile for better fit */
    .info-box {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        flex: 1;
    }

    .info-box h3 {
        color: #D6B743; /* Matched to button color for visual hierarchy */
        margin-top: 0;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .info-box p, .info-box li {
        font-size: 0.95rem;
        line-height: 1.5;
        opacity: 0.9;
    }

    /* 4. Start Button - Added margin-bottom to prevent it sticking to the edge */
    .start-btn { 
        padding: 15px 50px; 
        background: #D6B743; 
        color: black; 
        cursor: pointer; 
        border: none; 
        border-radius: 30px;
        font-weight: bold; 
        font-size: 1.2rem;
        margin-top: 10px;
        margin-bottom: 60px; /* Critical for mobile scroll clearance */
        transition: transform 0.2s;
        flex-shrink: 0;
    }

    .start-btn:hover { transform: scale(1.05); }

    /* 5. Mobile Specific Media Queries */
    @media (max-width: 768px) {
        #landing-overlay {
            padding-top: 40px;
        }

        #landing-overlay h1 {
            font-size: 2rem !important;
            text-align: center;
        }

        #landing-overlay h2 {
            font-size: 1.1rem !important;
            text-align: center;
            margin-bottom: 10px;
        }

        .content-container { 
            flex-direction: column; 
            margin: 20px 0;
        }

        .info-box {
            padding: 20px;
        }

        .start-btn {
            width: 100%; /* Full width button is easier to tap on mobile */
            max-width: 300px;
        }
    }
</style>
</head>
<body>

    <div id="landing-overlay">
    <h1 style="font-size: 3rem; margin-bottom: 0;">Under the Amaltaas Tree</h1>
    <h2 style="font-weight: 300; margin-top: 5px; opacity: 0.8;">Remembering Sabeen Mahmud (1974 - 2015)</h2> 

    <div class="content-container">
        <div class="info-box">
            <h3>About the Project</h3>
            <p>
                Sabeen was Pakistani human rights activist, entrepreneur, and designer.
                She stood for community, culture, and open dialogue. With these principles 
                founded The Second Floor (T2F), a coffee house and community space.
            </p>
            <p>    
                In 2015 after hosting a panel titled “Unsilencing Balochistan” Sabeen was shot 
                at a signal as she was leaving the event.
            </p>
            <p>
                This archive allows viewers to get to know Sabeen and her work through virtual reconstructions 
                of spaces she inhabited. Explore these spaces to discover the stories behind objects she cherished and memories from her friends, colleagues, and family.
            </p>
        </div>

        <div class="info-box">
            <h3>How to Explore</h3>
            <ul style="line-height: 1.6; padding-left: 20px;">
                <li><strong>Look Around:</strong> Click and drag your mouse.</li>
                <li><strong>Interact:</strong> Hover over icons to see titles. Click to open details.</li>
                <li><strong>Navigation:</strong> Look for the 'Exit' icons to move between rooms.</li>
            </ul>
        </div>
    </div>

    <button class="start-btn" onclick="startExperience()">ENTER ARCHIVE</button>
</div>

    <a-scene>
        <a-assets>
            <img id="bg-office" src="Assets/Models/Sabeens_office.webp">
            <img id="bg-bedroom" src="Assets/Models/Sabeens_Bedroom.webp">
            <img id="bg-Baby_Box" src="Assets/Models/Baby_Box.webp">
            <img id="bg-T2F_Gallery" src="Assets/Models/T2F Gallery.webp">
            <img id="bg-T2F_Cafe" src="Assets/Models/T2F_Cafe.webp">
        </a-assets>

    
        <!-- World Space -->
        <a-entity id="room-bedroom" visible="false">
            <a-sky src="#bg-bedroom"></a-sky>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-3 3 -2.75" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('plants_mahenaz')" hover-info="id: plants_mahenaz"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('fun_zahir')" hover-info="id: fun_zahir"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 -90 0" position="3 3.4 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('music_sheila')" hover-info="id: music_sheila"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.1 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mother_zahir')" hover-info="id: mother_zahir"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-1 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('meeting_zak')" hover-info="id: meeting_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 1.2 -0.9" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mac_zak')" hover-info="id: mac_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.65 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('tech_faiz')" hover-info="id: tech_faiz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 1.5 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('school_zareena')" hover-info="id: school_zareena"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 180 0" position="-0.5 1.5 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('free_hafza')" hover-info="id: free_hafza"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.3 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mother_salima')" hover-info="id: mother_salima"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 0.75 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('poem_zak')" hover-info="id: poem_zak"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 180 0" position="-1 0.75 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('adoption_ayesha')" hover-info="id: adoption_ayesha"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 90 0" position="-2.2 1.2 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('catchphrase_hafza')" hover-info="id: catchphrase_hafza"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('diana_zareena')" hover-info="id: diana_zareena"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.65 2.7 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('tech_omer')" hover-info="id: tech_omer"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 0.25 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('kinnaird_zak')" hover-info="id: kinnaird_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.6 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('bikes_tallat')" hover-info="id: bikes_tallat"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.8 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('humour_sheba')" hover-info="id: humour_sheba"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.8 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('humour_salima')" hover-info="id: humour_salima"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="1.4 1.5 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('music_faiz')" hover-info="id: music_faiz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="-90 90 0" position="-1.2 0.5 1.2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('back_mahenaz')" hover-info="id: back_mahenaz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.25 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeen_sabina')" hover-info="id: sabeen_sabina"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 90 0" position="-2.2 1.75 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('open_shirin')" hover-info="id: open_shirin"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="-90 90 0" position="-1.5 0.5 0.6" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000"onclick="interact('bedside_table')" hover-info="id: bedside_table"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="3 1 -1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('kgs_kameez')" hover-info="id: kgs_kameez"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 1 -0.9" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('macintosh_se')" hover-info="id: macintosh_se"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 1 -1.1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_mac_in_kc')" hover-info="id: sabeens_mac_in_kc"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="0.65 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('apple_poster')" hover-info="id: apple_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="90 -90 90" position="0.75 4 1.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('ball_marks_on_ceiling')" hover-info="id: ball_marks_on_ceiling"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0.2 3 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('chamakpati_ac')" hover-info="id: chamakpati_ac"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2.2 1.2 0.1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('license Plate')" hover-info="id: license Plate"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_shelf')" hover-info="id: sabeens_shelf"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="-90 90 0" position="-1.5 0.75 -0.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_desk')" hover-info="id: sabeens_desk"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="3 3.6 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('jim_morrison_poster')" hover-info="id: jim_morrison_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-1.75 2 -0.4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('hugh_laurie_portrait')" hover-info="id: hugh_laurie_portrait"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="2 2 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('cupboard')" hover-info="id: cupboard"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="2 -0.2 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('cricket_bats')" hover-info="id: cricket_bats"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 0 0" position="2 1 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('office')" hover-info="title: Go to Sabeen's Office"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 -90 0" position="3 1 -0.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('babybox')" hover-info="title: Go to Baby Box"></a-circle>

        </a-entity>
       
        <a-entity id="room-office" visible="false">
            <a-sky src="#bg-office"></a-sky>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 1" radius="0.08" color="#FFFFFF" onclick="interact('artefact_note_fahad_and_marium')" hover-info="id: artefact_note_fahad_and_marium"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 -0.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_note_goethe')" hover-info="id: artefact_note_goethe"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 2 -1" radius="0.08" color="#FFFFFF" onclick="interact('artefact_note_natasha_ejaz')" hover-info="id: artefact_note_natasha_ejaz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 0" radius="0.08" color="#FFFFFF" onclick="interact('artefact_note_nilofer_halai')" hover-info="id: artefact_note_nilofer_halai"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 2.1 1" radius="0.08" color="#FFFFFF" onclick="interact('artefact_note_shanzay_subzwari')" hover-info="id: artefact_note_shanzay_subzwari"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1 0" radius="0.08" color="#FFFFFF" onclick="interact('artefact_sabeens_pinboard')" hover-info="id: artefact_sabeens_pinboard"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0 1.2 4" radius="0.08" color="#FFFFFF" onclick="interact('artefact_white_board')" hover-info="id: artefact_white_board"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0.75 2 4" radius="0.08" color="#FFFFFF" onclick="interact('artefact_whiteboard_urdu')" hover-info="id: artefact_whiteboard_urdu"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="-0.6 3 4" radius="0.08" color="#FFFFFF" onclick="interact('artefact_hackathon_sticker')" hover-info="id: artefact_hackathon_sticker"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0 3 4" radius="0.08" color="#FFFFFF" onclick="interact('artefact_dil_phaink')" hover-info="id: artefact_dil_phaink"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="0 1.5 -3.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_paper_tray')" hover-info="id: artefact_paper_tray"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="-0.5 2.25 -3.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_last_sticky_note')" hover-info="id: artefact_last_sticky_note"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="-0.75 2 -3.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_magnet_board')" hover-info="id: artefact_magnet_board"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2 -1" radius="0.08" color="#FFFFFF" onclick="interact('artefact_billie_holiday_poster')" hover-info="id: artefact_billie_holiday_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.2 1 -2" radius="0.08" color="#FFFFFF" onclick="interact('artefact_books')" hover-info="id: artefact_books"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2.5 2.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_steve_jobs_painting')" hover-info="id: artefact_steve_jobs_painting"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2 1.8" radius="0.08" color="#FFFFFF" onclick="interact('artefact_steve_jobs_quote')" hover-info="id: artefact_steve_jobs_quote"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.75 4 -2" radius="0.08" color="#FFFFFF" onclick="interact('artefact_peaceniche_patch')" hover-info="id: artefact_peaceniche_patch"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="2.5 1.5 3.75" radius="0.08" color="#FFFFFF" onclick="interact('artefact_macintosh_se')" hover-info="id: artefact_macintosh_se"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="2 1.25 -3.75" radius="0.08" color="#FFFFFF" onclick="interact('artefact_faiz_aaj_kay_naam_cd_rom')" hover-info="id: artefact_faiz_aaj_kay_naam_cd_rom"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 -45 0" position="2.25 2 -3.5" radius="0.15" color="#FFFFFF" onclick="switchRoom('bedroom')" hover-info="title: Go to Sabeen's Bedroom"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-2 2.1 2.5" radius="0.15" color="#FFFFFF" onclick="switchRoom('cafe')" hover-info="title: Go to T2F Cafe"></a-circle>
        </a-entity>     

        <a-entity id="room-babybox" visible="false">
            <a-sky src="#bg-Baby_Box"></a-sky>
            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" color="#FFFFFF" onclick="interact('plants_mahenaz')"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2.5 1.5 0" radius="0.08" color="#FFFFFF" onclick="interact('artefact_raggedy_ann')" hover-info="id: artefact_raggedy_ann"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="0 -1.5 -1.5" radius="0.08" color="#FFFFFF" onclick="interact('artefact_flower_earrings')" hover-info="id: artefact_flower_earrings"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="1 2.5 2" radius="0.08" color="#FFFFFF" onclick="interact('artefact_view_master')" hover-info="id: artefact_view_master"></a-circle>

            <a-circle class="clickable"src="Assets/Icons/Exit_Room.png" position="2 1 -2" radius="0.1" color="#FFFFFF" onclick="switchRoom('bedroom')" hover-info="title: Go to Sabeen's Bedroom"></a-circle>
        </a-entity>

        <a-entity id="room-gallery" visible="false">
            <a-sky src="#bg-T2F_Gallery"></a-sky>
            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" color="#FFFFFF" onclick="interact('plants_mahenaz')"></a-circle>
            
            <a-circle class="clickable"src="Assets/Icons/Exit_Room.png" position="2 1 -2" radius="0.1" color="#FFFFFF" onclick="switchRoom('office')">
                <a-text value="RETURN TO OFFICE" align="center" position="0 0.6 0"></a-text>
            </a-circle>
        </a-entity>

        <a-entity id="room-cafe" visible="false">
            <a-sky src="#bg-T2F_Cafe"></a-sky>
            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" color="#FFFFFF" onclick="interact('plants_mahenaz')" hover-info="id: plants_mahenaz"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-3 2 4" radius="0.08" color="#FFFFFF" onclick="switchRoom('office')" hover-info="title: Go to Sabeen's Office"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-3 2 1" radius="0.08" color="#FFFFFF" onclick="switchRoom('gallery')" hover-info="title: Go to T2F Gallery"></a-circle>

            </a-circle>
        </a-entity>

        <a-entity id="rig">
            <a-camera id="main-camera">
                 <a-cursor 
                    raycaster="objects: .clickable"
                    color="#D6B743"
                    position="0 0 -0.5" 
                    scale="2 2 2"
                    opacity="0.8">
                </a-cursor>
               
               <a-entity id="fade-screen"
                    geometry="primitive: plane; width: 4; height: 4"
                    material="color: #F9F6E4; opacity: 0; transparent: true; shader: flat"
                    position="0 0 -0.1">
        
                     <a-image id="loader-graphic"
                        src="Assets/Images/LoadingScreen.webp" 
                        position="0 0 0.01"
                        width="0.1" 
                        height="0.1"
                        material="transparent: true; opacity: 0"
                        animation="property: rotation; to: 0 0 -360; loop: true; dur: 2000; easing: linear; enabled: false">
        </a-image>
    </a-entity>
            </a-camera>
            <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>
        </a-entity>
        
        <a-entity id="info-panel" visible="false" scale="0.7 0.7 0.7" look-at="#main-camera">
            <a-plane id="panel-bg" width="1.6" height="2.2" color="#1a1a1a" opacity="0.9"></a-plane>

            <a-text id="panel-title" value="" position="0 0.9 0.02" align="center" width="1.5" color="#f1c40f"></a-text>
            <a-image id="panel-img" visible="false" position="0 0.3 0.02" width="1.2" height="0.8"></a-image>
            <a-text id="panel-desc" value="" position="-0.7 0.2 0.02" align="left" width="1.4"></a-text>

            <a-entity id="audio-player-ui" visible="false" position="0 -0.6 0.02">
                <a-text id="audio-time" value="0:00 / 0:00" align="center" width="1.2" position="0 0.25 0" scale="0.8 0.8 0.8"></a-text>
        
                <a-circle id="play-pause-btn" class="clickable panel-button" src="Assets/Icons/Pause.png" position="0 -0.1 0.01" radius="0.1" color="#ffffff" onclick="togglePlayback()"></a-circle>
            </a-entity>

             <a-circle class="clickable panel-button" src="Assets/Icons/Cross Circle.png" position="0 -0.9 0.05" radius="0.08" onclick="closePanel()"></a-circle>
        </a-entity>

        <a-entity id="global-audio" sound="src: ; autoplay: false"></a-entity>

        <a-entity id="world-tooltip" visible="false" look-at="#main-camera">
             <a-rounded id="tooltip-bg" 
               width="1" height="0.4" 
               radius="0.05" 
               color="black" 
               opacity="0.8">
            </a-rounded>
                <a-text id="tooltip-text" 
                 value="" 
                 align="center" 
                    width="2.5" 
                    position="0 0.2 0.01">
                </a-text>
        </a-entity>
        
    </a-scene>
    

    <script src="database.js"></script>
    <script>
// 1. GLOBAL OBJECTS
let currentAudio = new Audio();
let updateTimer = null;

// 2. INTERACTION LOGIC
function interact(id) {
    const data = ARCHIVE_DATABASE[id];
    const panel = document.querySelector('#info-panel');
    const camera = document.querySelector('#main-camera');
    const panelImg = document.querySelector('#panel-img');
    const panelDesc = document.querySelector('#panel-desc');
    const audioPlayerUI = document.querySelector('#audio-player-ui');
    const playPauseBtn = document.querySelector('#play-pause-btn');

    // Position Panel
    const pos = new THREE.Vector3();
    camera.object3D.getWorldPosition(pos);
    const direction = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.object3D.quaternion);
    const spawnPos = new THREE.Vector3().copy(pos).add(direction.multiplyScalar(1.2));
    panel.setAttribute('position', spawnPos);
    panel.setAttribute('look-at', '#main-camera');

    // Reset State
    stopAudio();
    panelImg.setAttribute('visible', 'false');
    audioPlayerUI.setAttribute('visible', 'false');
    document.querySelector('#panel-title').setAttribute('value', data.title);

    if (data.type === 'image') {
        const imgLoader = new Image();
        imgLoader.onload = function() {
            const maxWidth = 1.3, maxHeight = 0.8;
            const aspectRatio = imgLoader.naturalWidth / imgLoader.naturalHeight;
            let finalWidth = maxWidth, finalHeight = maxWidth / aspectRatio;
            if (finalHeight > maxHeight) { finalHeight = maxHeight; finalWidth = maxHeight * aspectRatio; }
            
            panelImg.setAttribute('width', finalWidth);
            panelImg.setAttribute('height', finalHeight);
            panelImg.setAttribute('src', data.src);
            panelImg.setAttribute('visible', 'true');
            
            // Adjust text position based on image height
            const imageBottomY = 0.3 - (finalHeight / 2);
            const textPadding = 0.5; // <--- ADJUST THIS to increase/decrease gap
            const descY = imageBottomY - textPadding;
            panelDesc.setAttribute('position', {x: -0.7, y: descY, z: 0.02});
            panelDesc.setAttribute('value', `${data.meta.description}\n\nPhotographer: ${data.meta.author}`);
        };
        imgLoader.src = data.src;

    } else if (data.type === 'audio') {
        audioPlayerUI.setAttribute('visible', 'true');
        playPauseBtn.setAttribute('src', 'Assets/Icons/Pause.png'); // Reset to pause icon
        panelDesc.setAttribute('position', {x: -0.7, y: 0.2, z: 0.02});
        panelDesc.setAttribute('value', `${data.meta.description}\n\nSpeaker: ${data.meta.author}\nRelation: ${data.meta.relation}\nDate: ${data.meta.date}`);
        
        currentAudio.src = data.src;
        currentAudio.play().then(() => startProgressTracker()).catch(e => console.log("Play blocked"));
    }
    panel.setAttribute('visible', 'true');
}

// 3. AUDIO PLAYER UTILITIES
function togglePlayback() {
    const btn = document.querySelector('#play-pause-btn');
    if (currentAudio.paused) {
        currentAudio.play();
        btn.setAttribute('src', 'Assets/Icons/Pause.png');
        startProgressTracker();
    } else {
        currentAudio.pause();
        btn.setAttribute('src', 'Assets/Icons/Play.png');
        cancelAnimationFrame(updateTimer);
    }
}

function startProgressTracker() {
    const timeText = document.querySelector('#audio-time');

    function update() {
        // Only update if audio is playing
        if (!currentAudio.paused && !currentAudio.ended) {
            // Update the time codes only
            timeText.setAttribute('value', `${formatTime(currentAudio.currentTime)} / ${formatTime(currentAudio.duration)}`);
            
            updateTimer = requestAnimationFrame(update);
        } else if (currentAudio.ended) {
            // Reset button icon when audio finishes
            document.querySelector('#play-pause-btn').setAttribute('src', 'Assets/Icons/Play.png');
        }
    }
    updateTimer = requestAnimationFrame(update);
}

function stopAudio() {
    currentAudio.pause();
    currentAudio.currentTime = 0;
    cancelAnimationFrame(updateTimer);
}

function formatTime(secs) {
    if (isNaN(secs)) return "0:00";
    const mins = Math.floor(secs / 60);
    const s = Math.floor(secs % 60);
    return `${mins}:${s < 10 ? '0' : ''}${s}`;
}

function closePanel() {
    document.querySelector('#info-panel').setAttribute('visible', 'false');
    stopAudio();
}

// 4. ROOM & APP LOGIC
function startExperience() {
    const fadeScreen = document.querySelector('#fade-screen');
    const loader = document.querySelector('#loader-graphic');
    
    // 1. Fade the background to dark gray/black
    fadeScreen.setAttribute('animation', 'property: material.opacity; from: 0; to: 1; dur: 500; easing: easeInOutQuad');

    // 2. Fade in the loader image and start its spinning animation
    loader.setAttribute('animation__fade', 'property: material.opacity; from: 0; to: 1; dur: 500; easing: easeInOutQuad');
    loader.setAttribute('animation', 'enabled: true'); // Starts the rotation defined in HTML

    // 3. Timing for the room switch
    setTimeout(() => {
        // Hide the landing page UI
        document.getElementById('landing-overlay').style.display = 'none';
        
        // Change the 360 view
        switchRoom('bedroom');
        
        // 4. Wait a moment so the user sees the loader, then fade everything out
        setTimeout(() => {
            fadeScreen.setAttribute('animation', 'property: material.opacity; from: 1; to: 0; dur: 800; easing: easeInOutQuad');
            loader.setAttribute('animation__fade', 'property: material.opacity; from: 1; to: 0; dur: 800; easing: easeInOutQuad');
            
            // Stop rotation after fade out to save performance
            setTimeout(() => { loader.setAttribute('animation', 'enabled: false'); }, 800);
        }, 1000); // How long the loader stays visible after the room is "loaded"

    }, 600);
}
}

function switchRoom(roomID) {
    closePanel();
    
    // Disable all icons except panel buttons
    document.querySelectorAll('.clickable:not(.panel-button)').forEach(el => {
        el.classList.remove('clickable');
    });

    // Toggle Room Visibility
    document.querySelectorAll('[id^="room-"]').forEach(room => room.setAttribute('visible', 'false'));
    
    const targetRoom = document.getElementById('room-' + roomID);
    if (targetRoom) {
        targetRoom.setAttribute('visible', 'true');
        // Enable icons only in current room
        targetRoom.querySelectorAll('a-circle, a-image').forEach(el => {
            el.classList.add('clickable');
        });
    }

    const landingVideo = document.getElementById('landing-video');
    if (landingVideo) landingVideo.setAttribute('visible', 'false');
}
    </script>
    
</body>
</html>