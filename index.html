<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    // Replace this with YOUR actual config from the Firebase Console
    const firebaseConfig = {
        apiKey: "AIzaSyAvA4JDbbaHCLenqM1hOLBIW55-9SnVLQI",
        authDomain: "sabeen-mahmud-archive.firebaseapp.com",
        databaseURL: "https://sabeen-mahmud-archive-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "sabeen-mahmud-archive",
        storageBucket: "sabeen-mahmud-archive.appspot.com",
        messagingSenderId: "1024567890123",
        appId: "YOUR_APP_ID"
    };

// Initialize Firebase (using compat versions as per previous setup)
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// --- 2. GLOBAL STATE ---
let isAdmin = false;

// --- 3. TEXT MESSAGE LOGIC ---
function saveTextMessage() {
    const name = document.getElementById('guest-name').value || "Anonymous";
    const text = document.getElementById('guest-text').value;

    if (!text) return alert("Please share your thoughts first!");

    database.ref('messages').push({
        name: name,
        text: text,
        type: 'text',
        timestamp: Date.now()
    });

    document.getElementById('guest-text').value = "";
}

// --- 5. LIVE FEED & RENDERING ---
let feedSnapshot = null;

function renderFeed() {
    const container = document.getElementById('feed-container');
    if (!feedSnapshot) return;
    const data = feedSnapshot.val();
    let html = "";

    const messages = data ? Object.entries(data).reverse() : [];

    messages.forEach(([key, m]) => {
        if (!m) return;
        const type = m.type || (m.audioUrl ? 'audio' : 'text');

        // Admin Delete Button
        const deleteBtn = isAdmin ? 
            `<button class="delete-btn" onclick="deleteMessage('${key}', '${type}', '${m.audioUrl || ''}')">Delete</button>` : '';

        if (type === 'audio') {
            html += `
                <div class="feed-item" id="${key}">
                    ${deleteBtn}
                    <strong>${m.name || 'Voice Entry'}</strong>
                    <div style="display: flex; align-items: center; margin-top: 5px;">
                        <button id="btn-${key}" class="custom-audio-btn" onclick="toggleFeedAudio('${key}')">▶</button>
                        <span style="font-size: 0.85rem; margin-left: 10px; color: #555; font-style: italic;">Voice Note</span>
                        <audio id="audio-${key}" src="${m.audioUrl}" onended="resetFeedAudioButton('${key}')"></audio>
                    </div>
                </div>`;
        } else {
            html += `
                <div class="feed-item" id="${key}">
                    ${deleteBtn}
                    <strong>${m.name || 'Anonymous'}</strong>
                    <p>${m.text || ''}</p>
                </div>`;
        }
    });

    container.innerHTML = html || "<p>No messages yet. Be the first!</p>";
}

database.ref('messages').orderByChild('timestamp').on('value', (snapshot) => {
    feedSnapshot = snapshot;
    renderFeed();
});

// --- 5b. AUDIO FEED CONTROLS ---
function toggleFeedAudio(key) {
    const audio = document.getElementById(`audio-${key}`);
    const btn = document.getElementById(`btn-${key}`);
    
    // Stop other playing audios to prevent overlap
    document.querySelectorAll('audio[id^="audio-"]').forEach(a => {
        if (a !== audio) {
            a.pause();
            a.currentTime = 0;
            const k = a.id.replace('audio-', '');
            const b = document.getElementById(`btn-${k}`);
            if (b) {
                b.innerText = "▶";
                b.style.paddingLeft = "3px";
            }
        }
    });

    if (audio.paused) {
        audio.play();
        btn.innerText = "⏸";
        btn.style.paddingLeft = "0"; // Center pause icon
    } else {
        audio.pause();
        btn.innerText = "▶";
        btn.style.paddingLeft = "3px"; // Offset play icon visually
    }
}

function resetFeedAudioButton(key) {
    const btn = document.getElementById(`btn-${key}`);
    if (btn) {
        btn.innerText = "▶";
        btn.style.paddingLeft = "3px";
    }
}

// --- 6. MODERATION & ADMIN ---
function enterAdminMode() {
    const pw = prompt("Enter Moderation Password:");
    if (pw === "SabeenArchive2024") { 
        isAdmin = true;
        alert("Admin Mode Active. Red delete buttons will appear.");
        renderFeed();
    } else {
        alert("Incorrect password.");
    }
}

// Keyboard Shortcut: Ctrl + Shift + A to login as Admin
document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && (e.key === 'A' || e.key === 'a')) {
        enterAdminMode();
    }
});

async function deleteMessage(key, type, audioUrl) {
    if (!confirm("Are you sure you want to delete this entry?")) return;

    try {
        await database.ref('messages').child(key).remove();
        console.log("Deleted successfully");
    } catch (error) {
        console.error("Error deleting:", error);
    }
}

</script>

<script>
    </script>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-rounded@1.0.3/dist/aframe-rounded-component.min.js"></script>
    <link rel="icon" href="Assets/Icons/favicon.png" type="image/png">
    <script>

        AFRAME.registerComponent('proximity-reveal', {
        schema: {
        threshold: {type: 'number', default: 0.95}, // Lower is easier to find
        fadeInDur: {type: 'number', default: 500}
        },
        init: function () {
        this.el.setAttribute('material', 'opacity', 0);
        this.camera = document.querySelector('#main-camera');
        this.active = false;
        },
        tick: function () {
        // ERROR FIX: Stop running if the parent room is hidden
        if (!this.el.object3D.visible) return;
        // Extra check: ensure the room (parent) is actually visible
        if (this.el.parentNode && this.el.parentNode.object3D && !this.el.parentNode.object3D.visible) return;

        const targetPos = new THREE.Vector3();
        const cameraPos = new THREE.Vector3();
        
        // Use World Positions to avoid coordinate mismatches between rooms
        this.el.object3D.getWorldPosition(targetPos);
        this.camera.object3D.getWorldPosition(cameraPos);

        const cameraDir = new THREE.Vector3(0, 0, -1).applyQuaternion(this.camera.object3D.quaternion);
        const vecToTarget = targetPos.clone().sub(cameraPos).normalize();
        const angleMatch = cameraDir.dot(vecToTarget);

        if (angleMatch > this.data.threshold) {
            if (!this.active) {
                this.el.removeAttribute('animation'); // Clear old animations
                this.el.setAttribute('animation', `property: material.opacity; from: 0; to: 1; dur: ${this.data.fadeInDur}; easing: easeOutQuad`);
                this.active = true;
            }
        } else {
            if (this.active) {
                this.el.removeAttribute('animation');
                this.el.setAttribute('animation', `property: material.opacity; from: 1; to: 0; dur: ${this.data.fadeInDur}; easing: easeInQuad`);
                this.active = false;
            }
        }
        }
        });

        AFRAME.registerComponent('hover-info', {
        schema: { 
        id: {type: 'string', default: ''},
        title: {type: 'string', default: ''} 
        },
        init: function () {
        const el = this.el;
        
        el.addEventListener('mouseenter', () => {
            // ERROR FIX: If the icon is hidden, don't show tooltip
            if (!el.object3D.visible || el.getAttribute('material').opacity < 0.1) return;
            // Extra check: ensure the room (parent) is actually visible
            if (el.parentNode && el.parentNode.object3D && !el.parentNode.object3D.visible) return;

            const worldTooltip = document.querySelector('#world-tooltip');
            const tooltipText = document.querySelector('#tooltip-text');
            const tooltipBg = document.querySelector('#tooltip-bg');
            let displayTitle = "";

            // Check database or use manual title
            if (this.data.id && typeof ARCHIVE_DATABASE !== 'undefined') {
                const itemData = ARCHIVE_DATABASE[this.data.id];
                if (itemData) displayTitle = itemData.title;
            } else if (this.data.title) {
                displayTitle = this.data.title;
            }

            if (displayTitle && worldTooltip && tooltipText && tooltipBg) {
                tooltipText.setAttribute('value', displayTitle);
                
                // Dynamic width calculation
                const estimatedWidth = Math.max(0.6, displayTitle.length * 0.12);
                tooltipBg.setAttribute('width', estimatedWidth);
                
                // Center the background relative to the text
                tooltipBg.setAttribute('position', { x: -(estimatedWidth / 2), y: 0, z: 0 });

                // ERROR FIX: Use World Position so rooms don't overlap
                const worldPos = new THREE.Vector3();
                el.object3D.getWorldPosition(worldPos);
                
                worldTooltip.setAttribute('position', {
                    x: worldPos.x, 
                    y: worldPos.y + 0.4, 
                    z: worldPos.z
                });
                
                // Refresh look-at so it faces the camera immediately
                if (worldTooltip.components['look-at']) {
                    worldTooltip.components['look-at'].update();
                }
                worldTooltip.setAttribute('visible', true);
            }
        });

        el.addEventListener('mouseleave', () => {
            const worldTooltip = document.querySelector('#world-tooltip');
            if (worldTooltip) worldTooltip.setAttribute('visible', false);
        });
        }
        });
    </script>

  <style>
    
    #landing-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #F9F6E4 url('Assets/Images/Home page.png') no-repeat center center;
    background-size: cover;
    z-index: 9999; /* Stay above A-Frame */
    display: grid;
    grid-template-columns: 1fr 1fr;
    justify-items: center;
    align-items: center;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    transition: opacity 0.8s ease;
}


.home-menu {
    text-align: center;
    color: #393939;
}

.home-menu h1 { font-family:'Helvetica Neue', Arial, sans-serif; font-style:bold; font-size:200; letter-spacing: 4px; margin-bottom: 5px; }
.home-menu h2 { font-family:'Helvetica Neue', Arial, sans-serif; font-weight: 200; font-style: italic; margin-bottom: 40px; }

nav button {
    display: block;
    background: none;
    border: none;
    color: #393939;
    font-size: 1.2rem;
    margin: 15px auto;
    cursor: pointer;
    transition: color 0.3s;
}

nav button:hover { color: #D6B743; }

.overlay-content {
    animation: fadeIn 0.5s ease;
    grid-column: 2;
    width: 80%;
    max-width: 450px;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Additional styles for the new home layout */
.overlay-content input, .overlay-content textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-family: inherit;
    box-sizing: border-box;
}

.overlay-content button[type="submit"] {
    padding: 10px 20px;
    background: #D6B743;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    color: #393939;
}

.back-btn {
    background: transparent !important;
    border: 1px solid #393939 !important;
    margin-top: 0;
    margin-bottom: 20px;
    padding: 8px 16px;
    border-radius: 5px;
}

@media (max-width: 768px) {
    #landing-overlay {
        grid-template-columns: 1fr;
    }
    .overlay-content {
        grid-column: 1;
    }
}

     /* 1. Change the Loading Text */
        .a-loader-title {
            color: #393939 !important; /* Matches your dot color */
            font-family: sans-serif;
            font-size: 1.5rem !important;
            font-weight: thin !important;
            align-content: center;
    }

    /* To replace the "A-Frame" text with your project name: */
        .a-loader-title::after {
            content: "Entering the Archive"; /* Your custom text */
            display: block;
            margin-top: 350px;
            
    }

    /* 2. Change the Size of the Dots */
        .a-loader {
        /* Scale the entire loader container */
        transform: scale(1.5) !important; 
        border-color: #393939 !important;
    }

    /* 3. Ensure the background covers everything */
        .a-canvas {
        background-color: #F9F6E4 !important;
    }
    .delete-btn {
    float: right;
    background: #ff4d4d;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.8rem;
    margin-left: 10px;
}

.delete-btn:hover {
    background: #cc0000;
}

.feed-item {
    position: relative;
    overflow: hidden; /* Clears the float */
    background: #F9F6E4;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    text-align: left;
}

.feed-item strong {
    display: block;
    color: #D6B743;
    font-size: 0.9rem;
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.feed-item p {
    margin: 0;
    line-height: 1.4;
    color: #555;
}

.feed-item audio {
    width: 100%;
    height: 30px;
    margin-top: 5px;
}

#feed-container {
    max-height: 40vh;
    overflow-y: auto;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 8px;
    padding: 10px;
    margin-top: 20px;
    border: 1px solid rgba(0,0,0,0.1);
}

.message-controls {
    display: flex;
    gap: 10px;
}

.message-controls button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.1s;
}

.btn-post { background: #D6B743; color: #393939; }
.btn-record { background: #e74c3c; color: white; }

.message-controls button:active { transform: scale(0.98); }

.custom-audio-btn {
    background: #D6B743;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    color: #393939;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding-left: 3px; /* Visual adjustment for play triangle */
    transition: transform 0.1s;
    flex-shrink: 0;
}
.custom-audio-btn:active { transform: scale(0.9); }
</style>
</head>
<body>
    
    <div id="landing-overlay">
    <div id="home-section" class="overlay-content">
            <div class="home-menu">
                <h1>UNDER THE AMALTAAS TREE</h1>
                <h2>The Sabeen Mahmud Archive</h2>
                
                <nav>
                    <button onclick="showSection('about-section')">About</button>
                    <button onclick="showSection('instructions-section')">Enter Archive</button>
                    <button onclick="showSection('message-section')">Message to the Archive</button>
                    <button onclick="showSection('submit-section')">Contribute to the Archive</button>
                    <button onclick="showSection('acknowledgments-section')">Acknowledgments</button>
                </nav>
            </div>
    </div>

    <div id="about-section" class="overlay-content" style="display:none">
        <button class="back-btn" onclick="showSection('home-section')">← Back</button>
        <h3>About the Archive</h3>
        <p>Sabeen Mahmud was a human rights activist, entrepreneur and design enthusiast who stood for community, culture and open dialogue. In 2007 she founded The Second Floor (T2F) a café and community space.</p>
        <p>In April 2015 Sabeen hosted an event titled “Unsilencing Balochistan” opening a discourse on Balochistan’s disappeared people. Following this Sabeen was shot at a signal as she was leaving the event, cutting short a life that had impacted and changed so many.</p>
        <p>This archive allows viewers to get to know Sabeen Mahmud and her work through virtual reconstructions of spaces she inhabited. Explore these spaces to discover the stories behind artefacts and memories from her friends, colleagues, and family.</p>
    </div>

    <div id="instructions-section" class="overlay-content" style="display:none">
        <button class="back-btn" onclick="showSection('home-section')">← Back</button>
        <h3>How to Navigate</h3>
        <div style="text-align: left; margin-bottom: 25px; line-height: 1.6;">
            <p><strong>Look Around:</strong> Click and drag your cursor or move your device.</p>
            <p><strong>Interact:</strong> Hover over icons to reveal titles. Click to view content.</p>
            <p><strong>Explore:</strong> Look for 'Exit' icons to move between rooms.</p>
        </div>
        <button class="back-btn" onclick="startExperience()">Enter Archive</button>
    </div>

    <div id="message-section" class="overlay-content" style="display:none">
        <button class="back-btn" onclick="showSection('home-section')">← Back</button>
        <h3>Message to the Archive</h3>
        
        <div class="input-group">
            <input type="text" id="guest-name" placeholder="Your Name (Optional)">
            <textarea id="guest-text" placeholder="Share your memory or message..." rows="3"></textarea>
            
            <div class="message-controls">
                <button class="btn-post" onclick="saveTextMessage()">Post Message</button>
            </div>
        </div>

        <div id="feed-container">
            <p style="text-align:center; opacity:0.6;">Loading archive entries...</p>
        </div>

    </div>

    <div id="acknowledgments-section" class="overlay-content" style="display:none">
        <button class="back-btn" onclick="showSection('home-section')">← Back</button>
        <h2>Acknowledgments</h2>
        <p>Design & Development by Talha Kehar</p>
        <p>Data provided by Mahenaz Mahmud</p>
        <p>Data compilation by Marvi Mazhar & Associates</p>
        <p>Initial Design Concept by Najia Sabahat Khan</p>
        <p>Special Thanks to Mahenaz Mahmud and Prof. Emily Smith at UE Berlin for their continued support</p>
        <p> </p>
    </div>

    <div id="submit-section" class="overlay-content" style="display:none">
        <button class="back-btn" onclick="showSection('home-section')">← Back</button>
        <h3>Contribute to the Archive</h3>
        <form action="https://formspree.io/f/mbdddbqd" method="POST">
        <input type="text" name="name" placeholder="Your Name" required>
        <input type="email" name="_replyto" placeholder="Your Email" required>
        <textarea name="message" placeholder="How would you like to contribute..." required></textarea>
        <button type="submit">Send Message</button>
        </form>
        <div id="submit-confirmation" style="display:none; text-align: center; margin-bottom: 20px; color: #393939;">
            <p>Thank you! Your entry has been submitted.</p>
        </div>
    </div>
</div>

    <a-scene loading-screen="dotsColor: #393939; backgroundColor: #F9F6E4">
        
        <a-assets>
            <img id="bg-office" src="Assets/Models/Sabeens_office.webp">
            <img id="bg-bedroom" src="Assets/Models/Sabeens_Bedroom.webp">
            <img id="bg-Baby_Box" src="Assets/Models/Baby_Box.webp">
            <img id="bg-T2F_Gallery" src="Assets/Models/T2F Gallery.webp">
            <img id="bg-T2F_Cafe" src="Assets/Models/T2F_Cafe.webp">
        </a-assets>

        <!-- World Space -->
        <a-entity id="room-bedroom" visible="false">
            <a-sky src="#bg-bedroom"></a-sky>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-3 3 -2.75" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('plants_mahenaz')" hover-info="id: plants_mahenaz"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('fun_zahir')" hover-info="id: fun_zahir"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 -90 0" position="3 3.4 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('music_sheila')" hover-info="id: music_sheila"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.1 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mother_zahir')" hover-info="id: mother_zahir"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-1 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('meeting_zak')" hover-info="id: meeting_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 1.2 -0.9" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mac_zak')" hover-info="id: mac_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.65 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('tech_faiz')" hover-info="id: tech_faiz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 1.5 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('school_zareena')" hover-info="id: school_zareena"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 180 0" position="-0.5 1.5 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('free_hafza')" hover-info="id: free_hafza"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.3 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('mother_salima')" hover-info="id: mother_salima"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 0.75 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('poem_zak')" hover-info="id: poem_zak"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 180 0" position="-1 0.75 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('adoption_ayesha')" hover-info="id: adoption_ayesha"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 90 0" position="-2.2 1.2 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('catchphrase_hafza')" hover-info="id: catchphrase_hafza"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('diana_zareena')" hover-info="id: diana_zareena"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.65 2.7 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('tech_omer')" hover-info="id: tech_omer"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 45 0" position="-2 0.25 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('kinnaird_zak')" hover-info="id: kinnaird_zak"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.6 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('bikes_tallat')" hover-info="id: bikes_tallat"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.8 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('humour_sheba')" hover-info="id: humour_sheba"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="-0.8 0.5 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('humour_salima')" hover-info="id: humour_salima"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="1.4 1.5 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('music_faiz')" hover-info="id: music_faiz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="-90 90 0" position="-1.2 0.5 1.2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('back_mahenaz')" hover-info="id: back_mahenaz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 0 0" position="0.25 2.4 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeen_sabina')" hover-info="id: sabeen_sabina"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" rotation="0 90 0" position="-2.2 1.75 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('open_shirin')" hover-info="id: open_shirin"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="-90 90 0" position="-1.5 0.5 0.6" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000"onclick="interact('bedside_table')" hover-info="id: bedside_table"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="3 1 -1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('kgs_kameez')" hover-info="id: kgs_kameez"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 1 -0.9" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('macintosh_se')" hover-info="id: macintosh_se"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 1 -1.1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_mac_in_kc')" hover-info="id: sabeens_mac_in_kc"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="0.65 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('apple_poster')" hover-info="id: apple_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="90 -90 90" position="0.75 4 1.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('ball_marks_on_ceiling')" hover-info="id: ball_marks_on_ceiling"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0.2 3 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('chamakpati_ac')" hover-info="id: chamakpati_ac"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2.2 1.2 0.1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('license Plate')" hover-info="id: license Plate"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 45 0" position="-2 2.1 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_shelf')" hover-info="id: sabeens_shelf"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="-90 90 0" position="-1.5 0.75 -0.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('sabeens_desk')" hover-info="id: sabeens_desk"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="3 3.6 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('jim_morrison_poster')" hover-info="id: jim_morrison_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-1.75 2 -0.4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('hugh_laurie_portrait')" hover-info="id: hugh_laurie_portrait"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="2 2 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('cupboard')" hover-info="id: cupboard"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="2 -0.2 -3" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('cricket_bats')" hover-info="id: cricket_bats"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 0 0" position="2 1 -2" radius="0.1" material="transparent: true; opacity: 0.9" color="#000000" onclick="switchRoom('office')" hover-info="title: Go to Sabeen's Office"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 -90 0" position="3 1 -0.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('babybox')" hover-info="title: Go to Baby Box"></a-circle>

        </a-entity>
       
        <a-entity id="room-office" visible="false">
            <a-sky src="#bg-office"></a-sky>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_note_fahad_and_marium')" hover-info="id: artefact_note_fahad_and_marium"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 -0.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_note_goethe')" hover-info="id: artefact_note_goethe"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 2 -1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_note_natasha_ejaz')" hover-info="id: artefact_note_natasha_ejaz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1.5 0" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_note_nilofer_halai')" hover-info="id: artefact_note_nilofer_halai"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 2.1 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_note_shanzay_subzwari')" hover-info="id: artefact_note_shanzay_subzwari"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2 1 0" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_sabeens_pinboard')" hover-info="id: artefact_sabeens_pinboard"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0 1.2 4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_white_board')" hover-info="id: artefact_white_board"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0.75 2 4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_whiteboard_urdu')" hover-info="id: artefact_whiteboard_urdu"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="-0.6 3 4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_hackathon_sticker')" hover-info="id: artefact_hackathon_sticker"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="0 3 4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_dil_phaink')" hover-info="id: artefact_dil_phaink"></a-circle>
            
            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="0 1.5 -3.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_paper_tray')" hover-info="id: artefact_paper_tray"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="-0.5 2.25 -3.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#FFFFFF" onclick="interact('artefact_last_sticky_note')" hover-info="id: artefact_last_sticky_note"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="-0.75 2 -3.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_magnet_board')" hover-info="id: artefact_magnet_board"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2 -1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_billie_holiday_poster')" hover-info="id: artefact_billie_holiday_poster"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.2 1 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_books')" hover-info="id: artefact_books"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2.5 2.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_steve_jobs_painting')" hover-info="id: artefact_steve_jobs_painting"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.5 2 1.8" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_steve_jobs_quote')" hover-info="id: artefact_steve_jobs_quote"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 -90 0" position="2.75 4 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_peaceniche_patch')" hover-info="id: artefact_peaceniche_patch"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="2.5 1.5 3.75" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_macintosh_se')" hover-info="id: artefact_macintosh_se"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 0 0" position="2 1.25 -3.75" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_faiz_aaj_kay_naam_cd_rom')" hover-info="id: artefact_faiz_aaj_kay_naam_cd_rom"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 -45 0" position="2.25 2 -3.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('bedroom')" hover-info="title: Go to Sabeen's Bedroom"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-2 2.1 2.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('cafe')" hover-info="title: Go to T2F Cafe"></a-circle>
        </a-entity>     

        <a-entity id="room-babybox" visible="false">
            <a-sky src="#bg-Baby_Box"></a-sky>
            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" color="#FFFFFF" onclick="interact('plants_mahenaz')"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="-2.5 1.5 0" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_raggedy_ann')" hover-info="id: artefact_raggedy_ann"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 90 0" position="0 -1.5 -1.5" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_flower_earrings')" hover-info="id: artefact_flower_earrings"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Image.png" rotation="0 180 0" position="1 2.5 2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('artefact_view_master')" hover-info="id: artefact_view_master"></a-circle>
            
            <a-circle class="clickable"src="Assets/Icons/Exit_Room.png" position="2 1 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('bedroom')" hover-info="title: Go to Sabeen's Bedroom"></a-circle>
        </a-entity>

        <a-entity id="room-gallery" visible="false">
            <a-sky src="#bg-T2F_Gallery"></a-sky>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('plants_mahenaz')"></a-circle>

            <a-circle class="clickable"src="Assets/Icons/Exit_Room.png" position="2 1 -2" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('office')" hover-info="title: Go to Sabeen's Office"></a-circle>
        </a-entity>

        <a-entity id="room-cafe" visible="false">
            <a-sky src="#bg-T2F_Cafe"></a-sky>

            <a-circle class="clickable" src="Assets/Icons/Audio.png" position="1 1.5 -4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="interact('plants_mahenaz')" hover-info="id: plants_mahenaz"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-3 2 4" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('office')" hover-info="title: Go to Sabeen's Office"></a-circle>

            <a-circle class="clickable" src="Assets/Icons/Exit_Room.png" rotation="0 90 0" position="-3 2 1" radius="0.1" material="transparent: true; opacity: 0.9"proximity-reveal="threshold: 0.98"color="#000000" onclick="switchRoom('gallery')" hover-info="title: Go to T2F Gallery"></a-circle>
        </a-entity>

        <a-entity id="rig">
            <a-camera id="main-camera"">
                
                 <a-cursor 
                    raycaster="objects: .clickable; showLine: false; far: 100; interval: 50"
                    color="#D6B743"
                    scale="4 4 4"
                    border-color="#000000"
                    border-width="1">
                </a-cursor>

            </a-camera>
            <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>
        </a-entity>
        
        <a-entity id="info-panel" visible="false" scale="0.7 0.7 0.7" look-at="#main-camera">
            <a-plane id="panel-bg" width="1.6" height="2.2" color="#1a1a1a" opacity="0.9"></a-plane>

            <a-text id="panel-title" value="" position="0 0.9 0.02" align="center" width="1.5" color="#f1c40f"></a-text>
            <a-image id="panel-img" visible="false" position="0 0.3 0.02" width="1.2" height="0.8"></a-image>
            <a-text id="panel-desc" value="" position="-0.7 0.2 0.02" align="left" width="1.4"></a-text>

            <a-entity id="audio-player-ui" visible="false" position="0 -0.6 0.02">
                <a-text id="audio-time" value="0:00 / 0:00" align="center" width="1.2" position="0 0.25 0" scale="0.8 0.8 0.8"></a-text>
        
                <a-circle id="play-pause-btn" class="clickable panel-button" src="Assets/Icons/Pause.png" position="0 -0.1 0.01" radius="0.1" color="#ffffff" onclick="togglePlayback()"></a-circle>
            </a-entity>

             <a-circle class="clickable panel-button" src="Assets/Icons/Cross Circle.png" position="0 -0.9 0.05" radius="0.08" onclick="closePanel()"></a-circle>
        </a-entity>

        <a-entity id="global-audio" sound="src: ; autoplay: false"></a-entity>

        <a-entity id="world-tooltip" visible="false" look-at="#main-camera">
             <a-rounded id="tooltip-bg" 
               width="1" height="0.4" 
               radius="0.05" 
               color="black" 
               opacity="0.8">
            </a-rounded>
                <a-text id="tooltip-text" 
                 value="" 
                 align="center" 
                    width="2.5" 
                    position="0 0.2 0.01">
                </a-text>
        </a-entity>
        
    </a-scene>
    

    <script src="database.js"></script>
    <script>
// 1. GLOBAL OBJECTS
let currentAudio = new Audio();
let updateTimer = null;

// 2. INTERACTION LOGIC
function interact(id) {
    const data = ARCHIVE_DATABASE[id];
    const panel = document.querySelector('#info-panel');
    const camera = document.querySelector('#main-camera');
    const panelImg = document.querySelector('#panel-img');
    const panelDesc = document.querySelector('#panel-desc');
    const audioPlayerUI = document.querySelector('#audio-player-ui');
    const playPauseBtn = document.querySelector('#play-pause-btn');

    // Position Panel
    const pos = new THREE.Vector3();
    camera.object3D.getWorldPosition(pos);
    const direction = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.object3D.quaternion);
    const spawnPos = new THREE.Vector3().copy(pos).add(direction.multiplyScalar(1.2));
    panel.setAttribute('position', spawnPos);
    panel.setAttribute('look-at', '#main-camera');

    // Reset State
    stopAudio();
    panelImg.setAttribute('visible', 'false');
    audioPlayerUI.setAttribute('visible', 'false');
    document.querySelector('#panel-title').setAttribute('value', data.title);

    if (data.type === 'image') {
        const imgLoader = new Image();
        imgLoader.onload = function() {
            const maxWidth = 1.3, maxHeight = 0.8;
            const aspectRatio = imgLoader.naturalWidth / imgLoader.naturalHeight;
            let finalWidth = maxWidth, finalHeight = maxWidth / aspectRatio;
            if (finalHeight > maxHeight) { finalHeight = maxHeight; finalWidth = maxHeight * aspectRatio; }
            
            panelImg.setAttribute('width', finalWidth);
            panelImg.setAttribute('height', finalHeight);
            panelImg.setAttribute('src', data.src);
            panelImg.setAttribute('visible', 'true');
            
            // Adjust text position based on image height
            const imageBottomY = 0.3 - (finalHeight / 2);
            const textPadding = 0.5; // <--- ADJUST THIS to increase/decrease gap
            const descY = imageBottomY - textPadding;
            panelDesc.setAttribute('position', {x: -0.7, y: descY, z: 0.02});
            panelDesc.setAttribute('value', `${data.meta.description}\n\nPhotographer: ${data.meta.author}`);
        };
        imgLoader.src = data.src;

    } else if (data.type === 'audio') {
        audioPlayerUI.setAttribute('visible', 'true');
        playPauseBtn.setAttribute('src', 'Assets/Icons/Pause.png'); // Reset to pause icon
        panelDesc.setAttribute('position', {x: -0.7, y: 0.2, z: 0.02});
        panelDesc.setAttribute('value', `${data.meta.description}\n\nSpeaker: ${data.meta.author}\nRelation: ${data.meta.relation}\nDate: ${data.meta.date}`);
        
        currentAudio.src = data.src;
        currentAudio.play().then(() => startProgressTracker()).catch(e => console.log("Play blocked"));
    }
    panel.setAttribute('visible', 'true');
}

// 3. AUDIO PLAYER UTILITIES
function togglePlayback() {
    const btn = document.querySelector('#play-pause-btn');
    if (currentAudio.paused) {
        currentAudio.play();
        btn.setAttribute('src', 'Assets/Icons/Pause.png');
        startProgressTracker();
    } else {
        currentAudio.pause();
        btn.setAttribute('src', 'Assets/Icons/Play.png');
        cancelAnimationFrame(updateTimer);
    }
}

function startProgressTracker() {
    const timeText = document.querySelector('#audio-time');

    function update() {
        // Only update if audio is playing
        if (!currentAudio.paused && !currentAudio.ended) {
            // Update the time codes only
            timeText.setAttribute('value', `${formatTime(currentAudio.currentTime)} / ${formatTime(currentAudio.duration)}`);
            
            updateTimer = requestAnimationFrame(update);
        } else if (currentAudio.ended) {
            // Reset button icon when audio finishes
            document.querySelector('#play-pause-btn').setAttribute('src', 'Assets/Icons/Play.png');
        }
    }
    updateTimer = requestAnimationFrame(update);
}

function stopAudio() {
    currentAudio.pause();
    currentAudio.currentTime = 0;
    cancelAnimationFrame(updateTimer);
}

function formatTime(secs) {
    if (isNaN(secs)) return "0:00";
    const mins = Math.floor(secs / 60);
    const s = Math.floor(secs % 60);
    return `${mins}:${s < 10 ? '0' : ''}${s}`;
}

function closePanel() {
    document.querySelector('#info-panel').setAttribute('visible', 'false');
    stopAudio();
}

// 4. ROOM & APP LOGIC
function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.overlay-content').forEach(section => {
        section.style.display = 'none';
    });
    
    // Reset submit form state if opening submit section
    if (sectionId === 'submit-section') {
        const form = document.getElementById('entry-form');
        const confirm = document.getElementById('submit-confirmation');
        if (form) {
            form.style.display = 'block';
            form.reset();
        }
        if (confirm) confirm.style.display = 'none';
    }

    // Show the chosen one
    document.getElementById(sectionId).style.display = 'block';
}

function submitEntry(event) {
    event.preventDefault();
    
    // NOTE: To send email directly without opening a mail app, you need a backend service.
    // You can use a service like Formspree.io. Register there, get a form ID, 
    // and uncomment the fetch code below, replacing 'YOUR_FORM_ID'.
    
    /*
    const form = event.target;
    const data = new FormData(form);
    fetch("https://formspree.io/f/YOUR_FORM_ID", {
        method: "POST",
        body: data,
        headers: { 'Accept': 'application/json' }
    });
    */

    // Show confirmation message
    document.getElementById('entry-form').style.display = 'none';
    document.getElementById('submit-confirmation').style.display = 'block';
}

function startExperience() {
    const overlay = document.getElementById('landing-overlay');
    
    // Fade out the overlay
    overlay.style.opacity = '0';
    
    // Remove from DOM after fade completes so it doesn't block clicks
    setTimeout(() => {
        overlay.style.display = 'none';
        
        // Trigger your A-Frame room logic
        if (typeof switchRoom === "function") {
            switchRoom('bedroom'); 
        }
    }, 800);
}

function switchRoom(roomID) {
    // FIX 1: Manually hide the tooltip so it doesn't carry over
    const worldTooltip = document.querySelector('#world-tooltip');
    if (worldTooltip) worldTooltip.setAttribute('visible', 'false');

    // 2. Hide all rooms
    document.querySelectorAll('[id^="room-"]').forEach(room => {
        room.setAttribute('visible', 'false');
    });
    
    // 3. Show target room
    const targetRoom = document.getElementById('room-' + roomID);
    if (targetRoom) {
        targetRoom.setAttribute('visible', 'true');
    }
}


    </script>
    
</body>
</html>